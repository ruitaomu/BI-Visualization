<h4>Project Video Tags with duration Average</h4>
<table border="0" cellspacing="0" cellpadding="0" class="index_table">
  <thead>
  <tr>
    <th class="col col-name">Tag</th>
    <th class="col">Videos</th>
    <th class="col">Duration Average (HH:MM:SS)</th>
    <th class="col col-parent">Hierarchy</th>
    <th class="col action-icons"></th>
  </tr>
  </thead>
  <tbody>
  <% resource.videos_tags.each_with_index do |tag, index| %>
      <% tagged_video_ids = Tag.where(:name => tag.name).collect(&:video_id) %>
      <% tagged_videos = resource.videos.where('id IN (?)', tagged_video_ids) %>
      <% total_duration = [] %>

      <tr class="<%= index % 2 == 0 ? 'even':'odd' %>" id="tag_<%=tag.id%>">
        <td class="col col-name"><%= tag.name %></td>
        <td class="col">
          <% tagged_videos.each_with_index do |video, index| %>
            <%= ', ' unless index.eql?(0) %>
            <%= link_to video.tester.name, [resource, video] %>
          <% end %>
        </td>
        <td class="col">
          <% tagged_videos.each_with_index do |video, index| %>
              <% total_duration << video.tags.where(:name => tag.name).map(&:duration_in_secs) %>
          <% end %>
          <%= formatSeconds(eval("(#{total_duration.join('+')})/#{tagged_videos.count}").round(3)) %>
        </td>
        <td class="col col-name"><%= tag.parent_tag.present? ? tag.hierarchy : '' %></td>
        <td class="col action-icons">
          <div class="table_actions">
            <a title="Edit" href="<%= edit_tag_path(tag) %>">
              <span class="icon icon_pen">
                <svg id="" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 32 32.004" style="enable-background:new 0 0 32 32.004;" xml:space="preserve"><path fill="#5E6469" style="fill:#5E6469;" d="M29.656,2.344C28.1,0.781,26.053,0,24,0c-2.047,0-4.094,0.781-5.656,2.344L0.031,20.657L0,32.004 h11.312l18.344-18.347C32.781,10.535,32.781,5.468,29.656,2.344z M9.656,28.001H8v-4H4.021l0.006-1.681L21.172,5.172l0,0 l5.656,5.656v0L9.656,28.001z"></path></svg>
              </span>
            </a>
            <a title="Delete" data-confirm="Are you sure you want to delete this?" rel="nofollow"
               data-method="delete" href="<%= tag_path(tag) %>">
              <span class="icon icon_trash_stroke">
                <svg id="" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve"><g> <path fill="#5E6469" style="fill:#5E6469;" d="M32,4h-4h-4c0-2.211-1.789-4-4-4h-8C9.789,0,8,1.789,8,4H4H0v4h4v18c0,3.312,2.688,6,6,6h12 c3.312,0,6-2.688,6-6V8h4V4z M24,26c0,1.102-0.898,2-2,2H10c-1.102,0-2-0.898-2-2V8h16V26z"></path> <circle style="fill:#5E6469;" cx="12" cy="22" r="2"></circle> <circle style="fill:#5E6469;" cx="12" cy="14" r="2"></circle> <circle style="fill:#5E6469;" cx="20" cy="22" r="2"></circle> <circle style="fill:#5E6469;" cx="20" cy="14" r="2"></circle></g></svg>
              </span>
            </a>
          </div>
        </td>
      </tr>
   <% end %>
  </tbody>
</table>